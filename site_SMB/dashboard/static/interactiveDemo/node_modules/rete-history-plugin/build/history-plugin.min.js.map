{"version":3,"file":"history-plugin.min.js","sources":["../src/history.js","../src/action.js","../src/actions/node.js","../src/actions/connection.js","../src/index.js"],"sourcesContent":["export default class History {\n    constructor() {\n        this.active = false;\n        this.produced = [];\n        this.reserved = [];\n    }\n\n    add(action) {\n        if (this.active) return;\n        this.produced.push(action);\n        this.reserved = [];\n    }\n\n    get last() {\n        return this.produced[this.produced.length - 1];\n    }\n\n    _do(from, to, type) {\n        const action = from.pop();\n\n        if (!action) return;\n\n        this.active = true;\n        action[type]();\n        to.push(action);\n        this.active = false;\n    }\n\n    undo() {\n        this._do(this.produced, this.reserved, 'undo');\n    }\n\n    redo() {\n        this._do(this.reserved, this.produced, 'redo');\n    }\n}","export default class Action {\n    undo() {}\n    redo() {}\n}","import Action from '../action';\n\nclass NodeAction extends Action {\n    constructor(editor, node) {\n        super();\n        this.editor = editor;\n        this.node = node;\n    }\n}\n\nexport class AddNodeAction extends NodeAction {\n    undo() {\n        this.editor.removeNode(this.node);\n    }\n    redo() {\n        this.editor.addNode(this.node);\n    }\n}\n\nexport class RemoveNodeAction extends NodeAction {\n    undo() {\n        this.editor.addNode(this.node);\n    }\n    redo() {\n        this.editor.removeNode(this.node);\n    }\n}\n\nexport class DragNodeAction extends NodeAction {\n    constructor(editor, node, prev) {\n        super(editor, node);\n\n        this.prev = [...prev];\n        this.new = [...node.position];\n    }\n\n    _translate(position) {\n        this.editor.view.nodes.get(this.node).translate(...position);\n    }\n    \n    undo() {\n        this._translate(this.prev);\n    }\n    redo() {\n        this._translate(this.new);\n    }\n    update(node) {\n        this.new = [...node.position];\n    }\n}","import Action from '../action';\n\nfunction reassign(connection) {\n    const { input, output } = connection;\n\n    return output.connections.find(c => c.input === input);\n}\n\nexport class AddConnectionAction extends Action {\n    constructor(editor, connection) {\n        super();\n        this.editor = editor;\n        this.connection = connection;\n    }\n    undo() {\n        this.editor.removeConnection(this.connection);\n    }\n    redo() {\n        this.editor.connect(this.connection.output, this.connection.input);\n        this.connection = reassign(this.connection);\n    }\n}\n\nexport class RemoveConnectionAction extends Action {\n    constructor(editor, connection) {\n        super();\n        this.editor = editor;\n        this.connection = connection;\n    }\n    undo() {\n        this.editor.connect(this.connection.output, this.connection.input);\n        this.connection = reassign(this.connection);\n    }\n    redo() {\n        this.editor.removeConnection(this.connection);\n    }\n}\n","import History from './history';\nimport Act from './action';\nimport { AddNodeAction, DragNodeAction, RemoveNodeAction } from './actions/node';\nimport { AddConnectionAction, RemoveConnectionAction } from './actions/connection';\n\nfunction trackNodes(editor, history) {\n    editor.on('nodecreated', node => history.add(new AddNodeAction(editor, node)));\n    editor.on('noderemoved', node => history.add(new RemoveNodeAction(editor, node)));\n    editor.on('nodetranslated', ({ node, prev }) => {\n        if (history.last instanceof DragNodeAction && history.last.node === node)\n            history.last.update(node);\n        else\n            history.add(new DragNodeAction(editor, node, prev));\n    });\n}\n\nfunction trackConnections(editor, history) {\n    editor.on('connectioncreated', c => history.add(new AddConnectionAction(editor, c)));\n    editor.on('connectionremoved', c => history.add(new RemoveConnectionAction(editor, c)));\n}\n\nfunction install(editor, { keyboard = true }) {\n    editor.bind('undo');\n    editor.bind('redo');\n    editor.bind('addhistory');\n\n    const history = new History();\n\n    editor.on('undo', () => history.undo());\n    editor.on('redo', () => history.redo());\n    editor.on('addhistory', action => history.add(action));\n\n    if (keyboard) document.addEventListener('keydown', e => {\n        if (!e.ctrlKey) return;\n\n        switch (e.code) {\n        case 'KeyZ': editor.trigger('undo'); break;\n        case 'KeyY': editor.trigger('redo'); break;\n        default:\n        }\n    });\n\n    trackNodes(editor, history);\n    trackConnections(editor, history);\n}\n\nexport const Action = Act;\n\nexport default {\n    name: 'history',\n    install\n}"],"names":["History","active","produced","reserved","action","this","push","from","to","type","pop","_do","length","Action","NodeAction","editor","node","AddNodeAction","removeNode","addNode","RemoveNodeAction","DragNodeAction","prev","new","position","view","nodes","get","translate","_translate","reassign","connection","input","output","connections","find","c","AddConnectionAction","removeConnection","connect","RemoveConnectionAction","Act","name","install","keyboard","bind","history","on","undo","redo","add","document","addEventListener","e","ctrlKey","code","trigger","last","update"],"mappings":"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"}